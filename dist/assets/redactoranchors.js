(()=>{var l={redactoranchorsModal:'<form action=""><div class="form-item"><label for="modal-redactoranchors-name">## anchor-name ##</label><input type="text" id="modal-redactoranchors-name" name="id"></div></form>'};var s={en:{anchor:"Anchor","anchor-add":"Add anchor","anchor-name":"Name"},de:{anchor:"Sprungmarke","anchor-add":"Sprungmarke setzen","anchor-name":"Name"},fr:{anchor:"Ancre","anchor-add":"Ajouter une ancre","anchor-name":"Nom"},es:{anchor:"Ancla","anchor-add":"Agregar ancla","anchor-name":"Nombre"}};function r(){!$R.modals.link||!$R.modules.link||$R.modals.link.search('id="modal-link-anchor"')>=1||($R.modals.link=$R.modals.link.replace("</form>",'<div class="form-item"><label for="modal-link-text">## anchor ##</label><input type="text" id="modal-link-anchor" name="anchor"></div></form>'),$Link=$R.modules.link,$Link.prototype._setLinkDataOrigin=$Link.prototype._setLinkData,$Link.prototype._setFormDataOrigin=$Link.prototype._setFormData,$Link.prototype._setLinkData=function(t,e,n){if(e.anchor){e.anchor="#"+e.anchor.replace("#","").trim();let o=e.url.indexOf("#");o>=0?e.url=e.url.slice(0,o)+e.anchor+e.url.slice(o):e.url+=e.anchor,e.url=e.url.replace(/#$/,"")}this._setLinkDataOrigin(t,e,n)},$Link.prototype._setFormData=function(t,e){this._setFormDataOrigin(t,e);let n=t.getData(),o=n.url.match(/^(.*?)(#(?!entry\:[0-9]+).*?)?(#entry\:[0-9]+.*)?$/i);o&&o.length>2&&o[2]!==void 0&&(n.url=o[1]+(o[3]!==void 0?o[3]:""),n.anchor=o[2].replace("#",""),t.setData(n))},$Link.prototype._validateData=function(t,e){return e.url.trim()===""&&(!e.anchor||e.anchor.trim()==="")?t.setError("url"):!0})}function a(t){if(!t){this.app.api("module.inline.remove",{attr:"id"});return}this.app.api("module.inline.format",{attr:{id:t},tag:"span"})}function i(){let t=$R.dom(this.selection.getInline());return t.attr("id")?t.attr("id"):c(this.selection.isCollapsed()?t.text():this.selection.getText())}function c(t){return t?t.substring(0,50).trim().toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9-_.]/g,""):""}(function(t){t.add("plugin","redactoranchors",{modals:l,translations:s,init:e=>{this.app=e,this.opts=e.opts,this.lang=e.lang,this.toolbar=e.toolbar,this.selection=e.selection,this.opts.stylesClass+=" redactoranchorsWrapper",r()},start:()=>{this.toolbar.addButton("redactoranchors",{title:this.lang.get("anchor-add"),api:"plugin.redactoranchors.open"}).setIcon('<i class="re-icon-redactoranchors"></i>')},open:()=>{this.app.api("module.modal.build",{name:"redactoranchorsModal",title:this.lang.get("anchor"),width:"440px",handle:"save",commands:{save:{title:this.lang.get("save")},cancel:{title:this.lang.get("cancel")}}})},onmodal:{redactoranchorsModal:{open:(e,n)=>{this.selection.isCollapsed()&&this.selection.setAll(this.selection.getElement()),this.selection.save(),n.setData({id:i()})},opened:(e,n)=>{n.getField("id").focus()},save:(e,n)=>{let{id:o}=n.getData();if(o&&!o.match(/^[a-zA-Z][a-zA-Z0-9-_.]*$/gi))return n.setError("id"),!1;this.app.api("module.modal.close"),this.selection.restore(),a(o)}}}})})(Redactor);})();
