(()=>{var l={redactoranchorsModal:'<form><div class="form-item"><label for="modal-redactoranchors-name">## anchor-name ##</label><input type="text" id="modal-redactoranchors-name" name="id"></div></form>'};var c={en:{anchor:"Anchor","anchor-add":"Add anchor","anchor-name":"Name"},de:{anchor:"Sprungmarke","anchor-add":"Sprungmarke setzen","anchor-name":"Name"},fr:{anchor:"Ancre","anchor-add":"Ajouter une ancre","anchor-name":"Nom"},es:{anchor:"Ancla","anchor-add":"Agregar ancla","anchor-name":"Nombre"}};function a(e){!e.modals.link||!e.modules.link||(e.modals.link=e.modals.link.replace("</form>",'<div class="form-item"><label for="modal-link-text">## anchor ##</label><input type="text" id="modal-link-anchor" name="anchor"></div></form>'),$Link=e.modules.link,$Link.prototype._setLinkDataOrigin=$Link.prototype._setLinkData,$Link.prototype._setFormDataOrigin=$Link.prototype._setFormData,$Link.prototype._setLinkData=function(o,t,r){if(t.anchor){t.anchor="#"+t.anchor.replace("#","").trim();let n=t.url.indexOf("#");n>=0?t.url=t.url.slice(0,n)+t.anchor+t.url.slice(n):t.url+=t.anchor,t.url=t.url.replace(/#$/,"")}this._setLinkDataOrigin(o,t,r)},$Link.prototype._setFormData=function(o,t){this._setFormDataOrigin(o,t);let r=o.getData(),n=r.url.match(/^(.*?)(#(?!entry\:[0-9]+).*?)?(#entry\:[0-9]+.*)?$/i);n&&n.length>2&&n[2]!==void 0&&(r.url=n[1]+(n[3]!==void 0?n[3]:""),r.anchor=n[2].replace("#",""),o.setData(r))},$Link.prototype._validateData=function(o,t){return t.url.trim()===""&&(!t.anchor||t.anchor.trim()==="")?o.setError("url"):!0})}function i(e){return e?e.substring(0,50).trim().toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9-_.]/g,""):""}(function(e){e.add("plugin","redactoranchors",{modals:l,translations:c,init:o=>{this.app=o,this.opts=o.opts,this.lang=o.lang,this.$body=o.$body,this.toolbar=o.toolbar,this.selection=o.selection,this.opts.stylesClass+=" redactoranchorsWrapper",a(e)},start:()=>{let o={title:this.lang.get("anchor-add"),api:"plugin.redactoranchors.open"};this.toolbar.addButton("redactoranchors",o).setIcon('<i class="re-icon-redactoranchors"></i>')},open:()=>{let o=this.selection.getBlock();if(!o)return;this.$block=e.dom(o);let t={title:this.lang.get("anchor"),width:"440px",name:"redactoranchorsModal",commands:{save:{title:this.lang.get("save")},cancel:{title:this.lang.get("cancel")}}};this.app.api("module.modal.build",t)},onmodal:{redactoranchorsModal:{open:(o,t)=>{if(this.$block){let r=e.dom(this.$block);t.setData({id:r.attr("id")?r.attr("id"):i(r.text())})}},opened:(o,t)=>{t.getField("id").focus()},save:(o,t)=>{let r=t.getData();if(r.id==="")this.$block.removeAttr("id");else{if(!r.id.match(/^[a-zA-Z][a-zA-Z0-9-_.]*$/gi))return t.setError("id"),!1;this.$block.attr("id",r.id)}this.app.api("module.modal.close")}}}})})(Redactor);})();
